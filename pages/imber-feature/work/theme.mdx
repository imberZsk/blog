## git 常用指令

1.  查看提交信息：`git log`（git log --oneline 可以查看简介的提交信息）
2.  回滚到某次提交(版本回退/回滚本地代码)：`git reset --hard commitid`
3.  回滚到某次提交：`git revert commitid`
    - revert 只会取消那次提交
    - 会弹出 vim 模式修改需要的提交信息
    - 按下 i 进入可以输入的 insert 模式，然后修改成要的提交信息
    - 修改完后按 ESC 退出 insert 模式，进入 normal 模式
    - 按下:wq 保存并退出
    - 强制更新`git push -f`
4.  强制更新：`git push -f`
5.  合并其他分支（为一次提交）到当前分支：`git cherry-pick committed`
    - 一段提交，不包括 A：`git cherry-pick A..B`
6.  缓存文件，在一个分支没有开发完，要到另一个分支去处理问题，用 stash 缓存：`git stash`
7.  上线一个版本可能需要打 tag：`git tag v0.1`，推送 tag 用：`git push origin tag v0.1`
8.  修改上次提交的 commit 信息： `git commit --amend`，输入：`git commit --amend`，然后按 vim 模式保
9.  把最近 3 次提交的日志合并为 1 次：`git rebase -i HEAD~3`
    - 输入：git rebase -i HEAD~3
    - 先出现一个 vim 模式的文件，选择最近一次为 pick（必须第一个为 pick，否则会报错），其余为 s 表示压缩（同上编辑和保存）
    - 然后又出现一个 vim 模式文件，选择需要的提交信息，其余注释掉（同上编辑和保存）
    - 强制更新：git push -f

## css变量

新建一个`theme.ts`，引入`index.tsx`

```css
:root {
  --bgc: #ffffff;
}
.dark {
  --bgc: #17181a;
}
```

用的时候

```css
.div{
	background-color: var(--bgc)
}
```

## 主题切换

> 如果之前有设置过颜色用之前设置的主题色，在localStorage里看是否有主题变量保存
>
> 否则查询系统色，如果有匹配到暗色，使用暗色，否则默认白色

```js
// 切换为白色主题
const toLight = () => {
  localStorage.setItem('theme', 'light')
  const el = document.documentElement
  el.classList.remove('dark')
}
// 切换为黑色主题
const toDark = () => {
  localStorage.setItem('theme', 'dark')
  const el = document.documentElement
  el.classList.add('dark')
}
// 初始化主题
export const initTheme = () => {
  // 从local获取到的theme
  const theme = window.localStorage.getItem('theme')
  // 获取匹配到的系统主题色
  const matchMedia = window.matchMedia('(prefers-color-scheme:dark)')
  // 监听系统主题色改变
  matchMedia.onchange = () => {
    // 如果匹配到黑色
    if (matchMedia.matches) {
      toDark()
    } else {
      toLight()
    }
  }
  // 如果有设置过主题，取之前设置过的
  if (theme) {
    if (theme === 'dark') {
      toDark()
    } else {
      toLight()
    }
  }
  // 没有设置过取系统的黑色，没有取到默认设为白色
  else {
    if (matchMedia.matches) {
      toDark()
    } else {
      toLight()
    }
  }
}
// 手动切换
export const toggleTheme = () => {
  const el = document.documentElement
  if (el.classList.contains('dark')) {
    toLight()
  } else {
    toDark()
  }
}
```

## 读取上传的图片 url

```jsx
<input type="file" onChange={handleInput} />

const handleInput = (e: { target: { files: Blob[] } }) => {
const targetType = files[0].type
  const arr = ['image/jpeg', 'image/png', 'image/jpg', 'image/webp']
  if (!arr.includes(targetType)) {
    Toast.show({
      content: '格式不支持'
    })
    return
  }
  const files = e.target.files
  const reader = new FileReader()
  reader.readAsDataURL(files[0])
  reader.onloadend = function (e) {
    // target就是url
    const target = e.target?.result as string
  }
}
```

## node 下载 csv

用这个网站把 csv 转为 json,再用 nodefs 和 http 模块下载，https://tableconvert.com/csv-to-json

```js
const fs = require('fs')
const arr = require('./arr')
const https = require('https')
async function fn() {
  for (let i = 0; i < arr.length; i++) {
    await new Promise((resolve, reject) => {
      https.get(arr[i].path, (res) => {
        let data = ''
        res.setEncoding('binary')
        res.on('data', function (chunk) {
          data += chunk
        })
        res.on('end', () => {
          fs.writeFile(`./assets/${i}.jpg`, data, 'binary', (err) => {
            console.log(err)
          })
          resolve()
        })
      })
    })
  }
}
fn()
```
